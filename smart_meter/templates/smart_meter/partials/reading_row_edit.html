{# templates/smart_meter/partials/reading_row_edit.html #}
<tr id="row-{{ r.pk }}">
  {# Put inputs directly in cells. Include CSRF as a hidden input so HTMX can send it. #}
  <td class="col-ts text-nowrap" style="min-width:170px">
    {% csrf_token %}
    {{ form.ts }}
  </td>

  <td class="col-prop">
    <div class="form-control-plaintext p-0">{{ r.meter.unit.property.property_name }}</div>
    <div class="text-muted d-sm-none">Unit {{ r.meter.unit.unit_number }}</div>
  </td>

  <td class="col-unit">{{ r.meter.unit.unit_number }}</td>

  <td class="col-meter">{{ form.meter }}</td>

  <td class="col-ip">{{ form.source_ip }}</td>
  <td class="col-port">{{ form.source_port }}</td>

  <td class="col-volt">{{ form.voltage_a }}</td>
  <td class="col-amp">{{ form.current_a }}</td>
  <td class="col-watt">{{ form.total_power }}</td>

  <td class="col-energy">{{ form.total_energy }}</td>

  <td class="col-pf">
    <div class="d-flex gap-1 align-items-center flex-wrap">
      {{ form.pf_total }}
      <button type="button" class="btn btn-sm btn-success"
              hx-post="{% url 'smart_meter:meter_reading_row_edit' r.pk %}"
              hx-include="#row-{{ r.pk }}"
              hx-target="#row-{{ r.pk }}"
              hx-swap="outerHTML"
              title="Save">
        <i class="fas fa-check"></i>
      </button>

      <button type="button" class="btn btn-sm btn-secondary"
              hx-get="{% url 'smart_meter:meter_reading_row_edit' r.pk %}?cancel=1"
              hx-target="#row-{{ r.pk }}"
              hx-swap="outerHTML"
              title="Cancel">
        <i class="fas fa-times"></i>
      </button>

      <button type="button" class="btn btn-sm btn-danger"
            hx-post="{% url 'smart_meter:meter_reading_delete' r.pk %}"
            hx-include="#row-{{ r.pk }} [name=csrfmiddlewaretoken]"
            hx-swap="delete"
            hx-confirm="Delete this reading?">
    <i class="fas fa-trash"></i>
    </button>
    </div>

    {% if form.errors %}
      <div class="text-danger small mt-1">
        {% for field, errs in form.errors.items %}
          {% for e in errs %}{{ field }}: {{ e }}<br>{% endfor %}
        {% endfor %}
      </div>
    {% endif %}
  </td>
</tr>
