<div class="d-flex actions-wrap">
  {% if view_url %}
    <a href="{{ view_url }}" class="btn btn-sm btn-info action-btn btn-view">
      <i class="fas fa-eye"></i><span class="btn-text ms-1">View</span>
    </a>
  {% endif %}

  {% if edit_url %}
    <a href="{{ edit_url }}" class="btn btn-sm btn-warning action-btn btn-edit">
      <i class="fas fa-edit"></i><span class="btn-text ms-1">Edit</span>
    </a>
  {% endif %}

  {% if delete_url %}
    <a href="{{ delete_url }}" class="btn btn-sm btn-danger action-btn btn-delete">
      <i class="fas fa-trash"></i><span class="btn-text ms-1">Delete</span>
    </a>
  {% endif %}

  {% if receipt_urls %}
    <button type="button"
            class="btn btn-sm btn-secondary action-btn btn-receipt view-receipt"
            data-urls="{{ receipt_urls|join:'|' }}"
            title="Receipt" aria-label="Open receipt(s)">
      <i class="bi bi-receipt"></i><span class="btn-text ms-1">Receipt</span>
    </button>
  {% endif %}

  {# Invoice WA (hidden on payment rows) #}
  {% if record and record.lease and record.lease.tenant %}
    {% if record.lease.tenant.phone %}
      {% if not is_payment_row %}
        <a href="#"
           class="btn btn-sm btn-success action-btn btn-wa-invoice"
           title="Send WhatsApp"
           onclick="return window.sendWhatsAppSingleInvoiceFromList(this);"
           data-phone="{{ record.lease.tenant.phone|default:'' }}"
           data-fname="{{ record.lease.tenant.first_name|default:'' }}"
           data-lname="{{ record.lease.tenant.last_name|default:'' }}"
           data-invno="{{ record.invoice_number|default:'' }}"
           data-issue="{{ record.issue_date|date:'M d, Y' }}"
           data-due="{{ record.due_date|date:'M d, Y' }}"
           data-property="{{ record.lease.unit.property.property_name|default:'' }}"
           data-unit="{{ record.lease.unit.unit_number|default:'' }}"
           data-status="{{ record.get_status_display|default:'' }}"
           data-leasebal="{{ record.lease.get_balance|floatformat:2|intcomma }}"
           data-total="{{ record.amount|floatformat:2|intcomma }}"
           data-items='[{% for item in record.items.all %}{"cat":"{{ item.category.name|default:item.category|default_if_none:''|escapejs }}","desc":"{{ item.description|default:''|escapejs }}","amount":"{{ item.amount|floatformat:2|intcomma|escapejs }}"}{% if not forloop.last %},{% endif %}{% endfor %}]'>
          <i class="fab fa-whatsapp"></i><span class="btn-text ms-1">WhatsApp</span>
        </a>
      {% endif %}
    {% else %}
      <button type="button" class="btn btn-sm btn-secondary action-btn" title="No phone number" disabled>
        <i class="fab fa-whatsapp"></i><span class="btn-text ms-1">WhatsApp</span>
      </button>
    {% endif %}
  {% endif %}

  {% if make_payment_url %}
    <a href="{{ make_payment_url }}" class="btn btn-sm btn-success action-btn btn-pay">
      <i class="fas fa-money-bill-wave"></i><span class="btn-text ms-1">Pay</span>
    </a>
  {% endif %}

  {% if send_message_url %}
    <a href="{{ send_message_url }}" class="btn btn-sm btn-primary action-btn btn-message">
      <i class="fas fa-envelope"></i><span class="btn-text ms-1">Message</span>
    </a>
  {% endif %}

  {% if view_ledger_url %}
    <a href="{{ view_ledger_url }}" class="btn btn-sm btn-secondary action-btn btn-ledger">
      <i class="fas fa-file-invoice-dollar"></i><span class="btn-text ms-1">Ledger</span>
    </a>
  {% endif %}

  {% if send_ledger_url %}
    <a href="{{ send_ledger_url }}" class="btn btn-sm btn-info action-btn btn-ledger-send">
      <i class="fas fa-paper-plane"></i><span class="btn-text ms-1">Send Ledger</span>
    </a>
  {% endif %}

  {# Payment WA receipt (payments rows only) #}
  {% if is_payment_row %}
    {% if record.lease.tenant.phone %}
      <button type="button"
              class="btn btn-sm btn-success action-btn btn-wa-receipt"
              data-wa-url="{% url 'payments:api_payment_receipt_whatsapp' record.pk %}"
              title="Send WhatsApp Receipt">
        <i class="fab fa-whatsapp"></i><span class="btn-text ms-1">Receipt</span>
      </button>
    {% else %}
      <button type="button" class="btn btn-sm btn-secondary action-btn" title="No phone number" disabled>
        <i class="fab fa-whatsapp"></i><span class="btn-text ms-1">WhatsApp</span>
      </button>
    {% endif %}
  {% endif %}

  {# Lease reminder WA #}
  {% if is_lease_row %}
    {% if has_balance and whatsapp_url %}
      <button onclick="{{ whatsapp_url }}" class="btn btn-sm btn-success action-btn btn-wa-remind" title="Send WhatsApp Reminder">
        <i class="fab fa-whatsapp"></i><span class="btn-text ms-1">Remind</span>
      </button>
    {% else %}
      <button class="btn btn-sm btn-secondary action-btn btn-wa-remind disabled" title="No balance or phone">
        <i class="fab fa-whatsapp"></i><span class="btn-text ms-1">Remind</span>
      </button>
    {% endif %}
  {% endif %}
</div>
